<!--
================================================================================
ğŸ“š Bootcamp AI Tutor - í”„ë¡ íŠ¸ì—”ë“œ ë©”ì¸ í˜ì´ì§€
================================================================================
ì‘ì„±ì¼: 2026-01-05
ì„¤ëª…: ë¨¸ì‹ ëŸ¬ë‹ í•™ìŠµ ë„ìš°ë¯¸ AI ì±—ë´‡ UI

[íŒŒì¼ êµ¬ì¡°]
1. <head> - ë©”íƒ€ë°ì´í„°, ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬, CSS ìŠ¤íƒ€ì¼
2. <body> 
   - <aside class="sidebar"> - ì¢Œì¸¡ ì‚¬ì´ë“œë°” (ëª¨ë“œ ì„ íƒ)
   - <main class="main"> - ë©”ì¸ ì±„íŒ… ì˜ì—­
3. <script> - JavaScript ë¡œì§

[ìˆ˜ì • ê°€ì´ë“œ]
- ìƒ‰ìƒ ë³€ê²½: :root ë˜ëŠ” [data-theme="dark"] ë‚´ CSS ë³€ìˆ˜ ìˆ˜ì •
- ì§ˆë¬¸ ì¹´ë“œ ë³€ê²½: suggestions í´ë˜ìŠ¤ ë‚´ë¶€ ìˆ˜ì •
- ëª¨ë“œ ì¶”ê°€: SECTIONS ë°°ì—´ì— ì¶”ê°€
- ë¸Œëœë“œëª… ë³€ê²½: brand-text í´ë˜ìŠ¤ ë‚´ìš© ìˆ˜ì •

[ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬]
- marked.js: ë§ˆí¬ë‹¤ìš´ ë Œë”ë§
- highlight.js: ì½”ë“œ í•˜ì´ë¼ì´íŒ…
- Google Fonts (Inter): í°íŠ¸
================================================================================
-->
<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- ========================================
    [ê¸°ë³¸ ë©”íƒ€ íƒœê·¸]
    ======================================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootcamp AI Tutor</title>

    <!-- ========================================
    [ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬]
    - Google Fonts: Inter í°íŠ¸ (ë‹¤ì–‘í•œ êµµê¸°)
    - marked.js: ë§ˆí¬ë‹¤ìš´ â†’ HTML ë³€í™˜
    - highlight.js: ì½”ë“œ êµ¬ë¬¸ ê°•ì¡° (github-dark í…Œë§ˆ)
    ======================================== -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

    <style>
        /* ========================================
        ğŸ“¦ CSS ë³€ìˆ˜ ì •ì˜ (ë¼ì´íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’)
        ========================================
        
        [ìƒ‰ìƒ ìˆ˜ì • ë°©ë²•]
        ì•„ë˜ ë³€ìˆ˜ë“¤ì„ ìˆ˜ì •í•˜ë©´ ì „ì²´ ì•± ìƒ‰ìƒì´ ë³€ê²½ë©ë‹ˆë‹¤.
        
        --bg-primary: ë©”ì¸ ë°°ê²½ìƒ‰
        --bg-secondary: ì¹´ë“œ/ë°•ìŠ¤ ë°°ê²½ìƒ‰
        --bg-tertiary: 3ì°¨ ë°°ê²½ìƒ‰ (ì€ì€í•œ ê°•ì¡°)
        --bg-hover: í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰
        --accent: ë©”ì¸ ê°•ì¡°ìƒ‰ (í•‘í¬)
        --accent-light: ê°•ì¡°ìƒ‰ ë°ì€ ë²„ì „
        --accent-dark: ê°•ì¡°ìƒ‰ ì–´ë‘ìš´ ë²„ì „
        --accent-glow: ê°•ì¡°ìƒ‰ ê¸€ë¡œìš° íš¨ê³¼
        --text-primary: ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ
        --text-secondary: ë³´ì¡° í…ìŠ¤íŠ¸ ìƒ‰ìƒ
        --text-muted: íë¦° í…ìŠ¤íŠ¸ ìƒ‰ìƒ
        --border: í…Œë‘ë¦¬ ìƒ‰ìƒ
        --shadow: ê·¸ë¦¼ì íš¨ê³¼
        --radius-*: ë‘¥ê·¼ ëª¨ì„œë¦¬ í¬ê¸°
        --transition: ì• ë‹ˆë©”ì´ì…˜ ì „í™˜ íš¨ê³¼
        ======================================== */
        :root {
            /* ë°°ê²½ìƒ‰ */
            --bg-primary: #fffbfc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #fff5f8;
            --bg-hover: #ffeef4;

            /* ê°•ì¡°ìƒ‰ (í•‘í¬ ê³„ì—´) */
            --accent: #f9a8d4;
            --accent-light: #fbcfe8;
            --accent-dark: #f472b6;
            --accent-glow: rgba(249, 168, 212, 0.15);

            /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            --text-primary: #1f1f1f;
            --text-secondary: #6b5b6e;
            --text-muted: #b8a8bc;
            --text-white: #ffffff;

            /* ê¸°íƒ€ */
            --border: rgba(249, 168, 212, 0.2);
            --shadow: 0 2px 8px rgba(249, 168, 212, 0.1);
            --shadow-lg: 0 8px 32px rgba(249, 168, 212, 0.18);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --danger: #ef4444;
        }

        /* ========================================
        ğŸŒ™ ë‹¤í¬ ëª¨ë“œ ìƒ‰ìƒ ì •ì˜
        ========================================
        data-theme="dark" ì†ì„±ì´ <html>ì— ì¶”ê°€ë˜ë©´ ì ìš©ë©ë‹ˆë‹¤.
        ë³´ë¼ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ë¨
        ======================================== */
        [data-theme="dark"] {
            --bg-primary: #09071a;
            --bg-secondary: #0f0c24;
            --bg-tertiary: #161231;
            --bg-hover: #1e1940;
            --accent: #6d28d9;
            --accent-light: #7c3aed;
            --accent-dark: #3b0764;
            --accent-glow: rgba(109, 40, 217, 0.2);
            --text-primary: #f3f0ff;
            --text-secondary: #c4b5fd;
            --text-muted: #6d28d9;
            --border: rgba(76, 29, 149, 0.35);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 8px 32px rgba(76, 29, 149, 0.35);
        }

        /* ========================================
        ğŸ”„ ì „ì—­ ë¦¬ì…‹ ìŠ¤íƒ€ì¼
        ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            transition: var(--transition);
        }

        /* ========================================
        ğŸ“Œ ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼
        ========================================
        ì¢Œì¸¡ì— ê³ ì •ëœ 280px ë„ˆë¹„ì˜ ì‚¬ì´ë“œë°”ì…ë‹ˆë‹¤.
        
        [êµ¬ì„± ìš”ì†Œ]
        1. sidebar-header: ìƒë‹¨ ë¡œê³  + í…Œë§ˆ í† ê¸€
        2. sections-container: ëª¨ë“œ ì„ íƒ ì˜ì—­
        3. sidebar-footer: í•˜ë‹¨ ì´ˆê¸°í™” ë²„íŠ¼
        ======================================== */
        .sidebar {
            width: 280px;
            /* ì‚¬ì´ë“œë°” ë„ˆë¹„ - í•„ìš”ì‹œ ì¡°ì • */
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: fixed;
        }

        /* ì‚¬ì´ë“œë°” í—¤ë” (ë¡œê³  ì˜ì—­) */
        .sidebar-header {
            padding: 24px 20px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* ë¸Œëœë“œ ë¡œê³  */
        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-white);
            margin-left: auto;
            margin-right: auto;
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* [ìˆ˜ì • í¬ì¸íŠ¸] ë¸Œëœë“œëª… ë³€ê²½ ì‹œ ì—¬ê¸° + HTMLì˜ brand-text í´ë˜ìŠ¤ ë‚´ìš© ìˆ˜ì • */
        .brand-text {
            font-size: 18px;
            font-weight: 700;
        }

        /* í…Œë§ˆ í† ê¸€ ë²„íŠ¼ (ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ ì „í™˜) */
        .theme-toggle {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(15deg);
        }

        .theme-toggle svg {
            width: 18px;
            height: 18px;
        }

        /* ì„¹ì…˜(ëª¨ë“œ) ì»¨í…Œì´ë„ˆ */
        .sections-container {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        /* ========================================
        ğŸ“ ì„¹ì…˜(ëª¨ë“œ) ìŠ¤íƒ€ì¼
        ========================================
        ê° í•™ìŠµ ëª¨ë“œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¹´ë“œì…ë‹ˆë‹¤.
        í˜„ì¬ëŠ” 'í•™ìŠµí• ë˜ìš©' ëª¨ë“œë§Œ ìˆìŠµë‹ˆë‹¤.
        
        [ìƒˆ ëª¨ë“œ ì¶”ê°€ ë°©ë²•]
        JavaScriptì˜ SECTIONS ë°°ì—´ì— ì¶”ê°€í•˜ë©´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
        ======================================== */
        .section {
            margin-bottom: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .section.active {
            border-color: var(--accent);
        }

        .section-header {
            padding: 12px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .section-header:hover {
            background: var(--bg-hover);
        }

        .section.active .section-header {
            background: var(--accent-glow);
        }

        .section-info {
            flex: 1;
        }

        .section-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ì‚¬ì´ë“œë°” í‘¸í„° (ì´ˆê¸°í™” ë²„íŠ¼) */
        .sidebar-footer {
            padding: 12px;
            border-top: 1px solid var(--border);
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .reset-btn:hover {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }

        /* ========================================
        ğŸ“± ë©”ì¸ ì½˜í…ì¸  ì˜ì—­
        ========================================
        ì‚¬ì´ë“œë°” ì˜¤ë¥¸ìª½ì˜ ë©”ì¸ ì±„íŒ… ì˜ì—­ì…ë‹ˆë‹¤.
        ======================================== */
        .main {
            margin-left: 280px;
            /* ì‚¬ì´ë“œë°” ë„ˆë¹„ë§Œí¼ ë„ì›€ */
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
        }

        .chat-content {
            max-width: 800px;
            /* ì±„íŒ… ìµœëŒ€ ë„ˆë¹„ */
            margin: 0 auto;
            padding: 40px 24px;
        }

        /* [ì¶”ê°€] ìƒíƒœ í‘œì‹œê¸° ìŠ¤íƒ€ì¼ - í”„ë¦¬ë¯¸ì—„ ë²„ì „ */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #6b7280;
            margin-left: 6px;
            margin-right: 6px;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* ì •ìƒ (ì´ˆë¡) - í™”ë ¤í•œ ê¸€ë¡œìš° */
        .status-ok {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            border-color: rgba(52, 211, 153, 0.5);
            box-shadow:
                0 0 8px rgba(52, 211, 153, 0.8),
                0 0 16px rgba(52, 211, 153, 0.4);
            animation: glow-green 2s ease-in-out infinite;
        }

        @keyframes glow-green {

            0%,
            100% {
                box-shadow: 0 0 8px rgba(52, 211, 153, 0.8), 0 0 16px rgba(52, 211, 153, 0.4);
            }

            50% {
                box-shadow: 0 0 12px rgba(52, 211, 153, 1), 0 0 24px rgba(52, 211, 153, 0.6);
            }
        }

        /* ì˜¤ë¥˜ (ë¹¨ê°•) - ê¹œë¹¡ì„ ê¸€ë¡œìš° */
        .status-error {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            border-color: rgba(248, 113, 113, 0.5);
            box-shadow:
                0 0 8px rgba(248, 113, 113, 0.8),
                0 0 16px rgba(248, 113, 113, 0.4);
            animation: glow-red 1s ease-in-out infinite;
        }

        @keyframes glow-red {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* ========================================
        ğŸ§© í€´ì¦ˆ UI ìŠ¤íƒ€ì¼
        ======================================== */
        .quiz-container {
            max-width: 700px;
            margin: 40px auto;
            padding: 0 20px;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
        }

        /* í€´ì¦ˆ ì„¤ì • (ì‹œì‘ í™”ë©´) */
        .quiz-setup-card {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .quiz-setup-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            color: var(--text-primary);
        }

        .quiz-option-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .quiz-option-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .quiz-radio-group {
            display: flex;
            gap: 15px;
        }

        .quiz-radio-label {
            cursor: pointer;
            padding: 10px 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.2s;
            color: var(--text-primary);
        }

        .quiz-radio-input {
            display: none;
        }

        .quiz-radio-input:checked+.quiz-radio-label {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            font-weight: 600;
        }

        .quiz-input-number {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 16px;
        }

        .quiz-start-btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            font-size: 18px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .quiz-start-btn:hover {
            transform: scale(1.02);
        }

        /* ë¬¸ì œ í’€ì´ í™”ë©´ */
        .quiz-play-card {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .quiz-progress {
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--text-secondary);
            text-align: right;
            font-weight: 600;
        }

        .quiz-question-text {
            font-size: 22px;
            font-weight: 700;
            line-height: 1.5;
            margin-bottom: 40px;
            color: var(--text-primary);
            word-break: keep-all;
        }

        .quiz-ox-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .quiz-ox-btn {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            font-size: 40px;
            font-weight: 900;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .quiz-btn-o {
            color: #10b981;
            border-color: #10b981;
        }

        .quiz-btn-o:hover {
            background: #10b981;
            color: white;
        }

        .quiz-btn-x {
            color: #ef4444;
            border-color: #ef4444;
        }

        .quiz-btn-x:hover {
            background: #ef4444;
            color: white;
        }

        /* ê²°ê³¼/í•´ì„¤ í‘œì‹œ */
        .quiz-feedback {
            margin-top: 30px;
            padding: 20px;
            border-radius: 16px;
            animation: fadeIn 0.3s ease;
        }

        .quiz-feedback.correct {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
        }

        .quiz-feedback.wrong {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
        }

        .feedback-result {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .feedback-explanation {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .feedback-source {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: right;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding-top: 8px;
        }

        .quiz-next-btn {
            margin-top: 20px;
            width: 100%;
            padding: 14px;
            /* ê²€ìƒ‰ ë²„íŠ¼ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ì ìš© */
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }

        .quiz-next-btn:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* ìµœì¢… ê²°ê³¼ í™”ë©´ */
        .quiz-final-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--accent-color);
            margin: 20px 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* DB ìƒíƒœ í…ìŠ¤íŠ¸ (ì˜¤ë¥¸ìª½ ì•„ë˜ ê³ ì •) */
        .db-status-text {
            position: fixed;
            bottom: 16px;
            right: 16px;
            font-size: 13px;
            padding: 6px 12px;
            border-radius: 6px;
            background: transparent;
            z-index: 1000;
            font-weight: 500;
        }

        .db-status-ok {
            color: #10b981;
        }

        .db-status-error {
            color: #ef4444;
        }

        /* ========================================
        ğŸ‘‹ ì›°ì»´ í™”ë©´ ìŠ¤íƒ€ì¼
        ========================================
        ì²« í™”ë©´ì— í‘œì‹œë˜ëŠ” í™˜ì˜ ë©”ì‹œì§€ì™€ ì¶”ì²œ ì§ˆë¬¸ ì¹´ë“œì…ë‹ˆë‹¤.
        ======================================== */
        .welcome {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-badge {
            display: inline-block;
            padding: 6px 14px;
            background: var(--accent-glow);
            color: var(--accent);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 20px;
            border: 1px solid var(--accent);
        }

        .welcome-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            margin: 0 auto 28px;
            box-shadow: var(--shadow-lg);
        }

        .welcome h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .welcome p {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 48px;
        }

        /* ========================================
        ğŸ’¡ ì¶”ì²œ ì§ˆë¬¸ ì¹´ë“œ (Suggestions)
        ========================================
        ì‚¬ìš©ìê°€ í´ë¦­í•˜ë©´ í•´ë‹¹ ì§ˆë¬¸ì´ ìë™ìœ¼ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.
        
        [ì§ˆë¬¸ ìˆ˜ì • ë°©ë²•]
        HTMLì˜ suggestions í´ë˜ìŠ¤ ë‚´ë¶€ ë˜ëŠ”
        showWelcome() í•¨ìˆ˜ì˜ suggestions ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”.
        
        [ì¹´ë“œ êµ¬ì¡°]
        - suggestion-icon: ì•„ì´ì½˜ (ì´ëª¨ì§€)
        - suggestion-title: ì œëª©
        - suggestion-desc: ì„¤ëª…
        ======================================== */
        .suggestions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* 2ì—´ ê·¸ë¦¬ë“œ */
            gap: 16px;
            max-width: 560px;
            margin: 0 auto;
        }

        .suggestion {
            padding: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
        }

        .suggestion:hover {
            border-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .suggestion-icon {
            width: 44px;
            height: 44px;
            background: var(--accent-glow);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 14px;
        }

        .suggestion-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .suggestion-desc {
            font-size: 13px;
            color: var(--text-muted);
        }

        /* ========================================
        ğŸ’¬ ì±„íŒ… ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
        ========================================
        ì‚¬ìš©ì(user)ì™€ ë´‡(bot) ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.
        ======================================== */
        .message {
            padding: 28px 0;
            border-bottom: 1px solid var(--border);
            animation: fadeIn 0.4s ease;
        }

        .message:last-child {
            border-bottom: none;
        }

        /* ë©”ì‹œì§€ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 14px;
        }

        .message-avatar {
            width: 34px;
            height: 34px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* ì‚¬ìš©ì ë©”ì‹œì§€ ì•„ë°”íƒ€ */
        .message.user .message-avatar {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
        }

        /* ë´‡ ë©”ì‹œì§€ ì•„ë°”íƒ€ */
        .message.bot .message-avatar {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
        }

        .message-name {
            font-size: 14px;
            font-weight: 600;
        }

        .message-content {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-secondary);
            padding-left: 48px;
        }

        .message.user .message-content {
            color: var(--text-primary);
        }

        /* ì½”ë“œ ë¸”ë¡ ìŠ¤íƒ€ì¼ */
        .message-content pre {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 18px;
            margin: 16px 0;
            overflow-x: auto;
            font-family: monospace;
            font-size: 13px;
        }

        /* ì¸ë¼ì¸ ì½”ë“œ ìŠ¤íƒ€ì¼ */
        .message-content code {
            background: var(--accent-glow);
            color: var(--accent);
            padding: 3px 8px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
        }

        .message-content pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        /* ========================================
        âš™ï¸ Thinking Process (ì§„í–‰ ë‹¨ê³„ í‘œì‹œ)
        ========================================
        AIê°€ ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ê³¼ì •ì„ ë³´ì—¬ì£¼ëŠ” UIì…ë‹ˆë‹¤.
        ======================================== */
        .thought-process {
            margin: 16px 0 16px 48px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
            font-size: 13px;
        }

        .thought-header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .thought-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .status-badge {
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 10px;
            background: var(--accent);
            color: white;
            font-weight: 500;
        }

        .thought-body {
            padding: 0 16px 16px;
            display: none;
            border-top: 1px solid var(--border);
        }

        .thought-process.open .thought-body {
            display: block;
        }

        /* ë‹¨ê³„ë³„ í‘œì‹œ */
        .thought-step {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            position: relative;
        }

        /* ë‹¨ê³„ ì—°ê²°ì„  */
        .thought-step::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 26px;
            bottom: -14px;
            width: 2px;
            background: var(--border);
        }

        .thought-step:last-child::before {
            display: none;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            z-index: 1;
            color: var(--accent);
            font-weight: 700;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--text-primary);
        }

        .step-desc {
            color: var(--text-muted);
            font-size: 12px;
        }

        /* ========================================
        ğŸ“š ì°¸ê³  ìë£Œ (Sources) ì¹´ë“œ
        ========================================
        ì‘ë‹µì— í¬í•¨ëœ ì°¸ê³  ìë£Œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
        ======================================== */
        .sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .source-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px;
            font-size: 12px;
            transition: var(--transition);
        }

        .source-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        /* Best Match ì¹´ë“œ ìŠ¤íƒ€ì¼ (ë‹¤í¬ëª¨ë“œ í˜¸í™˜) */
        .best-match-card {
            background: var(--bg-secondary);
            border: 1px solid #f9a8d4;
            border-radius: 10px;
            padding: 10px 12px;
            margin-top: 16px;
            display: inline-flex;
            flex-direction: column;
            gap: 4px;
            max-width: 220px;
        }

        .best-match-header {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .best-match-badge {
            background: rgba(252, 231, 243, 0.2);
            color: #ec4899;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
        }

        .best-match-title {
            font-weight: 600;
            color: var(--accent);
            font-size: 12px;
        }

        .best-match-content {
            font-size: 10px;
            color: var(--text-muted);
            line-height: 1.3;
        }

        .best-match-score {
            font-size: 9px;
            color: var(--text-muted);
            text-align: right;
        }

        .source-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--accent-glow);
            color: var(--accent);
            font-size: 10px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .source-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .source-cell {
            color: var(--text-muted);
        }

        /* ========================================
        âŒ¨ï¸ ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼
        ========================================
        í•˜ë‹¨ì˜ ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ì…ë‹ˆë‹¤.
        ======================================== */
        .input-area {
            padding: 24px;
            background: linear-gradient(to top, var(--bg-primary) 60%, transparent);
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .input-box {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 10px 14px;
            display: flex;
            align-items: flex-end;
            gap: 14px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        /* ì…ë ¥ í¬ì»¤ìŠ¤ ì‹œ ê°•ì¡° íš¨ê³¼ */
        .input-box:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-glow);
        }

        .input-box textarea {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 18px;
            font-family: inherit;
            line-height: 1.6;
            resize: none;
            outline: none;
            max-height: 160px;
        }

        .input-box textarea::placeholder {
            color: var(--text-muted);
        }

        /* [ë‹¤í¬ ëª¨ë“œ] í€´ì¦ˆ ì¹´ë“œ ë°°ê²½ ë°ê²Œ ì¡°ì • */
        [data-theme="dark"] .quiz-play-card,
        [data-theme="dark"] .quiz-setup-card {
            background: #1a1a2e;
            /* ê¸°ì¡´ë³´ë‹¤ ë°ì€ ìƒ‰ìƒ */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ì „ì†¡ ë²„íŠ¼ */
        .send-btn {
            width: 34px;
            height: 34px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: var(--transition);
        }



        .send-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
        }

        /* ì…ë ¥ íŒíŠ¸ í…ìŠ¤íŠ¸ */
        .input-hint {
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 14px;
        }

        /* ========================================
        ğŸ“± ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼)
        ========================================
        768px ì´í•˜ì—ì„œëŠ” ì‚¬ì´ë“œë°”ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
        ======================================== */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>
    <!-- ========================================
    ğŸ“Œ ì‚¬ì´ë“œë°” ì˜ì—­
    ========================================
    ì¢Œì¸¡ ê³ ì • ì‚¬ì´ë“œë°”ì…ë‹ˆë‹¤.
    
    [êµ¬ì„±]
    1. sidebar-header: ë¡œê³  + í…Œë§ˆ í† ê¸€ ë²„íŠ¼
    2. sectionsContainer: ëª¨ë“œ ë²„íŠ¼ë“¤ (JavaScriptë¡œ ë Œë”ë§)
    3. sidebar-footer: ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼
    ======================================== -->
    <aside class="sidebar">
        <!-- í—¤ë”: ë¡œê³  + í…Œë§ˆ í† ê¸€ -->
        <div class="sidebar-header">
            <!-- ë¡œê³  ì•„ì´ì½˜ (ì™¼ìª½ ê³ ì •) -->
            <div class="brand-icon">ğŸ¥§</div>
            <div class="brand">
                <!-- [ìˆ˜ì • í¬ì¸íŠ¸] ë¸Œëœë“œëª… ë³€ê²½ -->
                <span class="brand-text">Py_Mate</span>
            </div>
            <!-- ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
                <svg id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
            </button>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ ì˜ì—­ (JavaScriptë¡œ ë™ì  ìƒì„±) -->
        <div class="sections-container" id="sectionsContainer"></div>

        <!-- í‘¸í„°: ì´ˆê¸°í™” ë²„íŠ¼ -->
        <div class="sidebar-footer">
            <button class="reset-btn" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
    </aside>

    <!-- ========================================
    ğŸ“± ë©”ì¸ ì½˜í…ì¸  ì˜ì—­
    ========================================
    ì±„íŒ…ì´ í‘œì‹œë˜ëŠ” ë©”ì¸ ì˜ì—­ì…ë‹ˆë‹¤.
    ======================================== -->
    <main class="main">
        <!-- ì±„íŒ… ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
        <div class="chat-area" id="chatArea">
            <div class="chat-content" id="chatContent">
                <!-- ========================================
                ğŸ‘‹ ì›°ì»´ í™”ë©´
                ========================================
                ì²˜ìŒ ë¡œë“œ ì‹œ í‘œì‹œë˜ëŠ” í™˜ì˜ ë©”ì‹œì§€ì…ë‹ˆë‹¤.
                
                [ìˆ˜ì • í¬ì¸íŠ¸]
                - ì¶”ì²œ ì§ˆë¬¸ ë³€ê²½: suggestion í´ë˜ìŠ¤ ìˆ˜ì •
                - onclickì— ì „ì†¡í•  ë©”ì‹œì§€ ì„¤ì •
                ======================================== -->
                <div class="welcome" id="welcome">
                    <div class="welcome-badge" id="modeBadge">í•™ìŠµ ëª¨ë“œ</div>
                    <img src="/image/pymate_logo.png" alt="PyMate"
                        style="width: 120px; height: auto; margin-bottom: 20px; border-radius: 16px;">
                    <h1>ë¬´ì—‡ì„ ë°°ìš°ê³  ì‹¶ìœ¼ì„¸ìš”?</h1>
                    <p>ë¶€íŠ¸ìº í”„ í•™ìŠµ ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ AI íŠœí„°ì…ë‹ˆë‹¤.</p>

                    <!-- ========================================
                    ğŸ’¡ ì¶”ì²œ ì§ˆë¬¸ ì¹´ë“œ
                    ========================================
                    í´ë¦­ ì‹œ í•´ë‹¹ ì§ˆë¬¸ì´ ìë™ ì „ì†¡ë©ë‹ˆë‹¤.
                    
                    [ì¶”ê°€/ìˆ˜ì • ë°©ë²•]
                    1. ê¸°ì¡´ ì¹´ë“œ ë³µì‚¬
                    2. onclickì˜ ë©”ì‹œì§€ ë³€ê²½
                    3. ì•„ì´ì½˜, ì œëª©, ì„¤ëª… ë³€ê²½
                    ======================================== -->
                    <div class="suggestions">
                        <!-- ì¹´ë“œ 1: ê³¼ì í•© -->
                        <div class="suggestion" onclick="send('ê³¼ì í•©ì´ ë­ê³  ì–´ë–»ê²Œ ë°©ì§€í•´?')">
                            <div class="suggestion-icon">ğŸ¯</div>
                            <div class="suggestion-title">ê³¼ì í•©ì´ ë­ê³  ì–´ë–»ê²Œ ë°©ì§€í•´?</div>
                            <div class="suggestion-desc">Overfitting ê°œë…ê³¼ í•´ê²°ë²•</div>
                        </div>
                        <!-- ì¹´ë“œ 2: ê²°ì •íŠ¸ë¦¬ vs ëœë¤í¬ë ˆìŠ¤íŠ¸ -->
                        <div class="suggestion" onclick="send('ê²°ì •íŠ¸ë¦¬ì™€ ëœë¤í¬ë ˆìŠ¤íŠ¸ ì°¨ì´ê°€ ë­ì•¼?')">
                            <div class="suggestion-icon">ğŸŒ³</div>
                            <div class="suggestion-title">ê²°ì •íŠ¸ë¦¬ì™€ ëœë¤í¬ë ˆìŠ¤íŠ¸ ì°¨ì´ê°€ ë­ì•¼?</div>
                            <div class="suggestion-desc">íŠ¸ë¦¬ ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ</div>
                        </div>
                        <!-- ì¹´ë“œ 3: train_test_split -->
                        <div class="suggestion" onclick="send('train_test_splitì€ ì™œ í•˜ëŠ” ê±°ì•¼?')">
                            <div class="suggestion-icon">ğŸ“Š</div>
                            <div class="suggestion-title">train_test_splitì€ ì™œ í•˜ëŠ” ê±°ì•¼?</div>
                            <div class="suggestion-desc">ë°ì´í„° ë¶„í• ì˜ í•„ìš”ì„±</div>
                        </div>
                        <!-- ì¹´ë“œ 4: ì •í™•ë„ vs ì •ë°€ë„ -->
                        <div class="suggestion" onclick="send('ì •í™•ë„ì™€ ì •ë°€ë„ ì°¨ì´ ì„¤ëª…í•´ì¤˜')">
                            <div class="suggestion-icon">ğŸ“ˆ</div>
                            <div class="suggestion-title">ì •í™•ë„ì™€ ì •ë°€ë„ ì°¨ì´ ì„¤ëª…í•´ì¤˜</div>
                            <div class="suggestion-desc">í‰ê°€ ì§€í‘œ ë¹„êµ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
        âŒ¨ï¸ ì…ë ¥ ì˜ì—­
        ========================================
        ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ê³  ì „ì†¡í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.
        ======================================== -->
        <div class="input-area">
            <div class="input-container">
                <div class="input-box">
                    <!-- ë©”ì‹œì§€ ì…ë ¥ì°½ -->
                    <textarea id="input" rows="1" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeydown="handleKey(event)"
                        oninput="autoResize(this)"></textarea>
                    <!-- ì „ì†¡ ë²„íŠ¼ -->
                    <button class="send-btn" onclick="send()" id="sendBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                        </svg>
                    </button>
                </div>
                <!-- [ìˆ˜ì • í¬ì¸íŠ¸] íŒíŠ¸ í…ìŠ¤íŠ¸ ë³€ê²½ -->
                <div class="input-hint">Enterë¡œ ì „ì†¡ Â· Shift+Enterë¡œ ì¤„ë°”ê¿ˆ Â· Powered by LangGraph</div>
            </div>
        </div>
    </main>

    <!-- ========================================
    ğŸ“œ JavaScript ë¡œì§
    ========================================
    
    [ì£¼ìš” í•¨ìˆ˜ ëª©ë¡]
    
    1. í…Œë§ˆ ê´€ë ¨
       - toggleTheme(): ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜
       - updateThemeIcon(): í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
    
    2. ëª¨ë“œ/ì„¹ì…˜ ê´€ë ¨
       - renderSections(): ì‚¬ì´ë“œë°” ëª¨ë“œ ë²„íŠ¼ ë Œë”ë§
       - selectMode(): ëª¨ë“œ ì„ íƒ ì²˜ë¦¬
       - showWelcome(): ì›°ì»´ í™”ë©´ í‘œì‹œ
    
    3. ì±„íŒ… ê´€ë ¨
       - send(): ë©”ì‹œì§€ ì „ì†¡ (ìŠ¤íŠ¸ë¦¬ë°)
       - addMessage(): ë©”ì‹œì§€ ì¶”ê°€
       - createBotMessage(): ë´‡ ë©”ì‹œì§€ ìƒì„±
       - updateBotMessage(): ë´‡ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
    
    4. UI ê´€ë ¨
       - showThinking(): ì§„í–‰ ìƒíƒœ í‘œì‹œ
       - addStep(): ì§„í–‰ ë‹¨ê³„ ì¶”ê°€
       - finishThinking(): ì§„í–‰ ìƒíƒœ ì™„ë£Œ
       - appendSources(): ì°¸ê³  ìë£Œ ì¶”ê°€
    
    5. ìœ í‹¸ë¦¬í‹°
       - autoResize(): ì…ë ¥ì°½ ìë™ í¬ê¸° ì¡°ì ˆ
       - handleKey(): í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
       - resetAll(): ì „ì²´ ì´ˆê¸°í™”
    ======================================== -->
    <script>
        // ========================================
        // ğŸ“Œ ì„¤ì • ë° ìƒíƒœ ë³€ìˆ˜
        // ========================================

        /**
         * [ìˆ˜ì • í¬ì¸íŠ¸] ëª¨ë“œ ì„¤ì •
         * ìƒˆ ëª¨ë“œë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ì´ ë°°ì—´ì— ê°ì²´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
         * id: ì„œë²„ì— ì „ì†¡ë˜ëŠ” ëª¨ë“œ ID
         * name: UIì— í‘œì‹œë˜ëŠ” ì´ë¦„
         */
        const SECTIONS = [
            { id: 'learning', name: 'í•™ìŠµí• ë˜ìš©' },
            { id: 'quiz', name: 'í€´ì¦ˆí’€ë˜ìš©' }
        ];

        // í˜„ì¬ ìƒíƒœ ë³€ìˆ˜ë“¤
        let currentMode = 'learning';  // í˜„ì¬ ì„ íƒëœ ëª¨ë“œ
        let isProcessing = false;      // ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì—¬ë¶€

        // ëª¨ë“œë³„ chatContent ìºì‹œ (ëª¨ë“œ ì „í™˜ ì‹œ ìƒíƒœ ìœ ì§€ìš©)
        const modeContentCache = {};

        // ========================================
        // ğŸŒ™ í…Œë§ˆ ê´€ë ¨ í•¨ìˆ˜
        // ========================================

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í…Œë§ˆ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        let isDark = localStorage.getItem('theme') === 'dark';
        if (isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            updateThemeIcon();
        }

        /**
         * ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜
         */
        function toggleTheme() {
            isDark = !isDark;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon();
        }

        /**
         * í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ (í•´/ë‹¬ ëª¨ì–‘)
         */
        function updateThemeIcon() {
            const icon = document.getElementById('themeIcon');
            icon.innerHTML = isDark
                ? '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>'  // ë‹¬
                : '<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>';  // í•´
        }

        // ========================================
        // ğŸ“ ëª¨ë“œ/ì„¹ì…˜ ê´€ë ¨ í•¨ìˆ˜
        // ========================================

        /**
         * ì‚¬ì´ë“œë°”ì— ëª¨ë“œ ë²„íŠ¼ë“¤ì„ ë Œë”ë§
         * SECTIONS ë°°ì—´ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì  ìƒì„±
         */
        function renderSections() {
            document.getElementById('sectionsContainer').innerHTML = SECTIONS.map(s => `
                <div class="section ${s.id === currentMode ? 'active' : ''}" data-mode="${s.id}">
                    <div class="section-header" onclick="selectMode('${s.id}')">
                        <div class="section-info">
                            <div class="section-name">${s.name}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /**
         * ëª¨ë“œ ì„ íƒ ì‹œ í˜¸ì¶œ
         * @param {string} mode - ì„ íƒëœ ëª¨ë“œ ID
         */
        /**
         * ëª¨ë“œ ì„ íƒ ì‹œ í˜¸ì¶œ
         * @param {string} mode - ì„ íƒëœ ëª¨ë“œ ID
         */
        function selectMode(mode) {
            try {
                // í˜„ì¬ ëª¨ë“œì˜ chatContent ì €ì¥
                const chatContent = document.getElementById('chatContent');
                if (chatContent && currentMode) {
                    modeContentCache[currentMode] = chatContent.innerHTML;
                }

                // ëª¨ë“  ì„¹ì…˜ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                // ì„ íƒëœ ì„¹ì…˜ì— active í´ë˜ìŠ¤ ì¶”ê°€
                const targetSection = document.querySelector(`.section[data-mode="${mode}"]`);
                if (targetSection) targetSection.classList.add('active');

                currentMode = mode;

                // í€´ì¦ˆ ëª¨ë“œì—ì„œëŠ” ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°
                const inputArea = document.querySelector('.input-area');
                if (inputArea) {
                    inputArea.style.display = (mode === 'quiz') ? 'none' : 'block';
                }

                // ìºì‹œëœ ì½˜í…ì¸ ê°€ ìˆìœ¼ë©´ ë³µì›, ì—†ìœ¼ë©´ ì›°ì»´ í™”ë©´
                if (modeContentCache[mode]) {
                    chatContent.innerHTML = modeContentCache[mode];
                } else {
                    showWelcome();
                }

                // modeBadge ì—…ë°ì´íŠ¸
                const badge = document.getElementById('modeBadge');
                if (badge) {
                    const info = SECTIONS.find(s => s.id === mode);
                    badge.textContent = info ? info.name + ' ëª¨ë“œ' : mode + ' ëª¨ë“œ';
                }
            } catch (e) {
                console.error('selectMode ì˜¤ë¥˜:', e);
            }
        }

        /**
         * ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œ
         */
        async function resetAll() {
            if (!confirm('ëª¨ë“  ëŒ€í™”ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            await fetch('/reset', { method: 'POST' });
            location.reload();
        }

        /**
         * ì›°ì»´ í™”ë©´ í‘œì‹œ
         * ëª¨ë“œ ë³€ê²½ ì‹œ ë˜ëŠ” ì´ˆê¸° ë¡œë“œ ì‹œ í˜¸ì¶œë¨
         */
        function showWelcome() {
            const info = SECTIONS.find(s => s.id === currentMode);

            // í€´ì¦ˆ ëª¨ë“œì¼ ê²½ìš° ë³„ë„ UI ë Œë”ë§
            if (currentMode === 'quiz') {
                document.getElementById('chatContent').innerHTML = `
                    <div class="quiz-container">
                        <div class="quiz-setup-card">
                            <div class="quiz-setup-title">ì˜¤ëŠ˜ì˜ í€´ì¦ˆ ë„ì „! ğŸ§©</div>
                            
                            <div class="quiz-option-group">
                                <label class="quiz-option-label">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                                <div class="quiz-radio-group">
                                    <input type="radio" id="catAll" name="quizCategory" value="all" class="quiz-radio-input" checked>
                                    <label for="catAll" class="quiz-radio-label">ëª¨ë‘</label>
                                    
                                    <input type="radio" id="catLec" name="quizCategory" value="lecture" class="quiz-radio-input">
                                    <label for="catLec" class="quiz-radio-label">ê°•ì˜ìë£Œ</label>

                                    <input type="radio" id="catPy" name="quizCategory" value="python" class="quiz-radio-input">
                                    <label for="catPy" class="quiz-radio-label">íŒŒì´ì¬ ê¸°ì´ˆ</label>
                                </div>
                            </div>

                            <div class="quiz-option-group">
                                <label class="quiz-option-label">ë¬¸í•­ ìˆ˜ (5 ~ 20)</label>
                                <input type="number" id="quizCount" class="quiz-input-number" value="5" min="5" max="20">
                            </div>

                            <button id="btnStartQuiz" class="quiz-start-btn" onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
                        </div>
                    </div>
                `;
                return;
            }

            // [ê¸°ì¡´] í•™ìŠµ ëª¨ë“œ ì›°ì»´ í™”ë©´
            document.getElementById('chatContent').innerHTML = `
                <div class="welcome" id="welcome">
                    <!-- ë°°ì§€ ì œê±°ë¨ -->
                    <img src="/image/pymate_logo.png" alt="PyMate" style="width: 220px; height: auto; margin-bottom: 30px; border-radius: 16px;">
                    <h1>ë¬´ì—‡ì„ ë°°ìš°ê³  ì‹¶ìœ¼ì„¸ìš”?</h1>
                    <p>ë¶€íŠ¸ìº í”„ í•™ìŠµ ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ AI íŠœí„°ì…ë‹ˆë‹¤.</p>
                    <div class="suggestions">
                        <div class="suggestion" onclick="send('ê³¼ì í•©ì´ ë­ê³  ì–´ë–»ê²Œ ë°©ì§€í•´?')">
                            <div class="suggestion-icon">ğŸ¯</div>
                            <div class="suggestion-title">ê³¼ì í•©ì´ ë­ê³  ì–´ë–»ê²Œ ë°©ì§€í•´?</div>
                            <div class="suggestion-desc">Overfitting ê°œë…ê³¼ í•´ê²°ë²•</div>
                        </div>
                        <div class="suggestion" onclick="send('ê²°ì •íŠ¸ë¦¬ì™€ ëœë¤í¬ë ˆìŠ¤íŠ¸ ì°¨ì´ê°€ ë­ì•¼?')">
                            <div class="suggestion-icon">ğŸŒ³</div>
                            <div class="suggestion-title">ê²°ì •íŠ¸ë¦¬ì™€ ëœë¤í¬ë ˆìŠ¤íŠ¸ ì°¨ì´ê°€ ë­ì•¼?</div>
                            <div class="suggestion-desc">íŠ¸ë¦¬ ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ</div>
                        </div>
                        <div class="suggestion" onclick="send('train_test_splitì€ ì™œ í•˜ëŠ” ê±°ì•¼?')">
                            <div class="suggestion-icon">ğŸ“Š</div>
                            <div class="suggestion-title">train_test_splitì€ ì™œ í•˜ëŠ” ê±°ì•¼?</div>
                            <div class="suggestion-desc">ë°ì´í„° ë¶„í• ì˜ í•„ìš”ì„±</div>
                        </div>
                        <div class="suggestion" onclick="send('ì •í™•ë„ì™€ ì •ë°€ë„ ì°¨ì´ ì„¤ëª…í•´ì¤˜')">
                            <div class="suggestion-icon">ğŸ“ˆ</div>
                            <div class="suggestion-title">ì •í™•ë„ì™€ ì •ë°€ë„ ì°¨ì´ ì„¤ëª…í•´ì¤˜</div>
                            <div class="suggestion-desc">í‰ê°€ ì§€í‘œ ë¹„êµ</div>
                        </div>
                    </div>
                </div>
            `;
        }


        // ========================================
        // âŒ¨ï¸ ì…ë ¥ ê´€ë ¨ í•¨ìˆ˜
        // ========================================

        /**
         * ì…ë ¥ì°½ ìë™ ë†’ì´ ì¡°ì ˆ
         * @param {HTMLElement} el - textarea ìš”ì†Œ
         */
        function autoResize(el) {
            el.style.height = 'auto';
            el.style.height = Math.min(el.scrollHeight, 160) + 'px';
        }

        /**
         * í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
         * Enter: ì „ì†¡ / Shift+Enter: ì¤„ë°”ê¿ˆ
         */
        function handleKey(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                send();
            }
        }

        // ========================================
        // ğŸ’¬ ì±„íŒ… ê´€ë ¨ í•¨ìˆ˜ (í•µì‹¬ ë¡œì§)
        // ========================================

        /**
         * ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ (ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹)
         * 
         * @param {string} text - ì „ì†¡í•  ë©”ì‹œì§€ (ì—†ìœ¼ë©´ ì…ë ¥ì°½ ê°’ ì‚¬ìš©)
         * 
         * [ë™ì‘ ìˆœì„œ]
         * 1. ì‚¬ìš©ì ë©”ì‹œì§€ í™”ë©´ì— í‘œì‹œ
         * 2. Thinking Process í‘œì‹œ
         * 3. ì„œë²„ì— ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­
         * 4. ì‘ë‹µì„ ê¸€ì ë‹¨ìœ„ë¡œ ìˆ˜ì‹ í•˜ë©° ì‹¤ì‹œê°„ í‘œì‹œ
         * 5. ì™„ë£Œ ì‹œ ì°¸ê³  ìë£Œ í‘œì‹œ
         */
        async function send(text) {
            if (isProcessing) return;  // ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì´ë©´ ë¬´ì‹œ

            const input = document.getElementById('input');
            const msg = text || input.value.trim();
            if (!msg) return;

            // ìƒíƒœ ì„¤ì •
            isProcessing = true;
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('welcome')?.remove();

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMessage('user', msg);
            if (!text) input.value = '';

            // ğŸ’­ ìƒê° ì¤‘... (Thinking Process) UI í‘œì‹œ
            const thinkId = 'think-' + Date.now();
            showThinking(thinkId); // Changed from addThinking to showThinking to match existing function name

            let botDiv = null;
            let answer = '';
            let sources = [];

            try {
                // fetch ìš”ì²­ ì‹œì‘ (ìŠ¤íŠ¸ë¦¬ë°)
                const response = await fetch('/chat/stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                // ìŠ¤íŠ¸ë¦¼ ë°ì´í„° ì½ê¸° ë£¨í”„
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');

                    // SSE(Server-Sent Events) í˜•ì‹ íŒŒì‹±
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));

                                // ë°ì´í„° íƒ€ì…ë³„ ì²˜ë¦¬
                                if (data.type === 'step') {
                                    // ì§„í–‰ ë‹¨ê³„ ì¶”ê°€
                                    addStep(thinkId, data.data.step, data.data.title, data.data.desc);
                                } else if (data.type === 'char') {
                                    // ê¸€ì ìˆ˜ì‹ 
                                    if (!botDiv) {
                                        finishThinking(thinkId);
                                        botDiv = createBotMessage();
                                    }
                                    answer += data.data;
                                    updateBotMessage(botDiv, answer);
                                } else if (data.type === 'sources') {
                                    sources = data.data;
                                    if (botDiv && sources.length > 0) {
                                        appendBestMatch(botDiv, sources[0]);
                                    }
                                } else if (data.type === 'web_sources') {
                                    const webSources = data.data;
                                    if (botDiv && webSources.length > 0) {
                                        appendWebSources(botDiv, webSources);
                                    }
                                } else if (data.type === 'suggestions') {
                                    if (botDiv && data.data && data.data.length > 0) {
                                        appendSuggestions(botDiv, data.data);
                                    }
                                } else if (data.type === 'done') {
                                }
                            } catch (e) { /* JSON íŒŒì‹± ì—ëŸ¬ ë¬´ì‹œ */ }
                        }
                    }
                }
            } catch (e) {
                finishThinking(thinkId);
                addMessage('bot', 'âš ï¸ ì„œë²„ ì—°ê²° ì˜¤ë¥˜');
            }

            // ìƒíƒœ ë³µì›
            isProcessing = false;
            document.getElementById('sendBtn').disabled = false;
        }

        /**
         * ë´‡ ë©”ì‹œì§€ div ìƒì„±
         * @returns {HTMLElement} ìƒì„±ëœ ë©”ì‹œì§€ div
         */
        function createBotMessage() {
            const div = document.createElement('div');
            div.className = 'message bot';
            div.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">
                        <img src="/image/pymate_logo.png" alt="AI" style="width: 100%; height: 100%; border-radius: 50%;">
                    </div>
                    <div class="message-name">AI Tutor</div>
                </div>
                <div class="message-content"></div>
            `;
            document.getElementById('chatContent').appendChild(div);
            return div;
        }

        /**
         * ë´‡ ë©”ì‹œì§€ ë‚´ìš© ì—…ë°ì´íŠ¸ (ë§ˆí¬ë‹¤ìš´ ë Œë”ë§)
         * @param {HTMLElement} div - ë©”ì‹œì§€ div
         * @param {string} text - ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸
         */
        function updateBotMessage(div, text) {
            div.querySelector('.message-content').innerHTML = marked.parse(text);
            // ìë™ ìŠ¤í¬ë¡¤
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }

        /**
         * Best Match ì¹´ë“œ ì¶”ê°€ (ë‹µë³€ ì•„ë˜ì— í‘œì‹œ)
         */
        function appendBestMatch(div, source) {
            if (div.querySelector('.best-match-card')) return;
            const scorePercent = (source.score * 100).toFixed(1);
            const html = `
                <div class="best-match-card">
            <div class="best-match-header">
                <span class="best-match-badge">${source.type}</span>
                <div class="best-match-title">${source.title}</div>
            </div>
            <div style="font-size: 13px; color: #4b5563; margin: 8px 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                ${source.content || 'ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.'}
            </div>
            <div class="best-match-score">ìœ ì‚¬ë„: ${scorePercent}%</div>
        </div>
            `;
            div.querySelector('.message-content').insertAdjacentHTML('beforeend', html);
        }

        /**
         * ì™¸ë¶€ ê²€ìƒ‰ ê²°ê³¼ ì¹´ë“œ ì¶”ê°€
         */
        function appendWebSources(div, webSources) {
            if (div.querySelector('.web-sources-container')) return;

            const html = `
                <div class="web-sources-container" style="margin-top: 12px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                    <div style="font-size: 13px; font-weight: 600; color: #3b82f6; margin-bottom: 8px;">ğŸŒ ì™¸ë¶€ ì°¸ê³  ìë£Œ (Web Search)</div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        ${webSources.map(s => `
                            <a href="${s.url}" target="_blank" style="text-decoration: none; display: flex; flex-direction: column; gap: 4px; padding: 10px; background: white; border-radius: 6px; border: 1px solid #e5e7eb; transition: transform 0.2s;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="font-size: 14px;">ğŸ”—</div>
                                    <div style="font-size: 13px; font-weight: 600; color: #1f2937; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">${s.title}</div>
                                </div>
                                <div style="font-size: 12px; color: #4b5563; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                    ${s.content || 'ë‚´ìš© ì—†ìŒ'}
                                </div>
                                <div style="font-size: 11px; color: #9ca3af;">${s.url}</div>
                            </a>
                        `).join('')}
                    </div>
                </div>
            `;
            div.querySelector('.message-content').insertAdjacentHTML('beforeend', html);
        }

        /**
         * ì¶”ì²œ ì§ˆë¬¸ ë²„íŠ¼ ì¶”ê°€ (ë‹µë³€ ì•„ë˜ì— í‘œì‹œ)
         */
        function appendSuggestions(div, suggestions) {
            const html = `
                <div style="margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px;">
                    ${suggestions.map(q => `
                        <button onclick="send('${q.replace(/'/g, "\\'")}')"
                            style="padding: 8px 14px; border-radius: 20px; border: 1px solid var(--accent); 
                                   background: var(--bg-tertiary); color: var(--accent); font-size: 13px;
                                   cursor: pointer;">
                            ğŸ”— ${q}
                        </button>
                    `).join('')}
                </div>
            `;
            div.querySelector('.message-content').innerHTML += html;
        }

        /**
         * ì°¸ê³  ìë£Œ ì¹´ë“œ ì¶”ê°€
         * @param {HTMLElement} div - ë©”ì‹œì§€ div
         * @param {Array} sources - ì°¸ê³  ìë£Œ ë°°ì—´
         */
        function appendSources(div, sources) {
            const srcHtml = `
                <div class="sources-grid">
                    ${sources.map(s => `
                        <div class="source-card">
                            <span class="source-type">${s.type}</span>
                            <div class="source-title">${s.title}</div>
                            <div class="source-cell">${s.content}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            div.querySelector('.message-content').innerHTML += srcHtml;
        }

        /**
         * ì¶”ì²œ ì§ˆë¬¸ ë²„íŠ¼ ì¶”ê°€ (í´ë¦­ ì‹œ ë°”ë¡œ ì§ˆë¬¸)
         * @param {HTMLElement} div - ë©”ì‹œì§€ div
         * @param {Array} suggestions - ì¶”ì²œ ì§ˆë¬¸ ë°°ì—´
         */
        function appendSuggestions(div, suggestions) {
            const suggestHtml = `
                <div class="suggestions-container" style="margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px;">
                    ${suggestions.map(q => `
                        <button class="suggestion-btn" onclick="send('${q.replace(/'/g, "\\'")}')"
                            style="padding: 8px 14px; border-radius: 20px; border: 1px solid var(--accent); 
                                   background: var(--bg-tertiary); color: var(--accent); font-size: 13px;
                                   cursor: pointer; transition: 0.2s;">
                            ğŸ’¬ ${q}
                        </button>
                    `).join('')}
                </div>
            `;
            div.querySelector('.message-content').innerHTML += suggestHtml;
        }

        /**
         * ë©”ì‹œì§€ ì¶”ê°€ (ì‚¬ìš©ì ë˜ëŠ” ë´‡)
         * @param {string} sender - 'user' ë˜ëŠ” 'bot'
         * @param {string} text - ë©”ì‹œì§€ í…ìŠ¤íŠ¸
         * @param {Array} sources - ì°¸ê³  ìë£Œ (ì„ íƒ)
         */
        function addMessage(sender, text, sources = null) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            const avatar = sender === 'bot' ?
                '<img src="/image/pymate_logo.png" alt="AI" style="width: 100%; height: 100%; border-radius: 50%;">' :
                'ğŸ‘¤';

            let srcHtml = '';
            if (sources?.length) {
                srcHtml = `
                    <div class="sources-grid">
                        ${sources.map(s => `
                            <div class="source-card">
                                <span class="source-type">${s.type}</span>
                                <div class="source-title">${s.title}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            div.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-name">${sender === 'bot' ? 'AI Tutor' : 'Student'}</div>
                </div>
                <div class="message-content">${marked.parse(text)}${srcHtml}</div>
            `;

            document.getElementById('chatContent').appendChild(div);
            // ìë™ ìŠ¤í¬ë¡¤
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
            // ì½”ë“œ í•˜ì´ë¼ì´íŒ…
            div.querySelectorAll('pre code').forEach(b => hljs.highlightElement(b));
        }

        // ========================================
        // âš™ï¸ Thinking Process ê´€ë ¨ í•¨ìˆ˜
        // ========================================

        /**
         * Thinking Process UI í‘œì‹œ
         * @param {string} id - ê³ ìœ  ID
         */
        function showThinking(id) {
            const div = document.createElement('div');
            div.className = 'thought-process open';
            div.id = id;
            div.innerHTML = `
                <div class="thought-header" onclick="this.parentElement.classList.toggle('open')">
                    <div class="thought-title">
                        âš™ï¸ Thinking Process 
                        <span class="status-badge" id="${id}-status">Processing...</span>
                    </div>
                    <span style="font-size:12px;opacity:0.5">â–¼</span>
                </div>
                <div class="thought-body" id="${id}-body"></div>
            `;
            document.getElementById('chatContent').appendChild(div);
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }

        /**
         * ì§„í–‰ ë‹¨ê³„ ì¶”ê°€
         * @param {string} id - Thinking Process ID
         * @param {number} num - ë‹¨ê³„ ë²ˆí˜¸
         * @param {string} title - ë‹¨ê³„ ì œëª©
         * @param {string} desc - ë‹¨ê³„ ì„¤ëª…
         */
        function addStep(id, num, title, desc) {
            const body = document.getElementById(`${id}-body`);
            if (body) {
                body.innerHTML += `
                    <div class="thought-step">
                        <div class="step-icon">${num}</div>
                        <div class="step-content">
                            <div class="step-title">${title}</div>
                            <div class="step-desc">${desc}</div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }

        /**
         * Thinking Process ì™„ë£Œ ì²˜ë¦¬
         * @param {string} id - Thinking Process ID
         */
        function finishThinking(id) {
            const badge = document.getElementById(`${id}-status`);
            if (badge) {
                badge.textContent = 'Complete';
                badge.style.background = '#10b981';  // ì´ˆë¡ìƒ‰
            }
            // 0.8ì´ˆ í›„ ìë™ ì ‘ê¸°
            setTimeout(() => document.getElementById(id)?.classList.remove('open'), 800);
        }

        // ========================================
        // ğŸ¥ ì„œë²„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        // ========================================

        /**
         * 5ì´ˆë§ˆë‹¤ ì„œë²„ ìƒíƒœ ì²´í¬
         */
        // ========================================
        // ğŸ§© í€´ì¦ˆ ê´€ë ¨ ë³€ìˆ˜ ë° í•¨ìˆ˜
        // ========================================
        let currentQuizData = [];
        let currentQuizIndex = 0;
        let quizScore = 0;

        async function startQuiz() {
            const category = document.querySelector('input[name="quizCategory"]:checked').value;
            const count = document.getElementById('quizCount').value;

            // ë¡œë”© í‘œì‹œ (ê°„ë‹¨íˆ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½)
            const btn = document.getElementById('btnStartQuiz');
            const originalText = btn.textContent;
            btn.textContent = 'ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            btn.disabled = true;

            try {
                const res = await fetch(`/api/quiz?category=${category}&count=${count}`);
                const data = await res.json();

                if (data.success && data.quizzes.length > 0) {
                    currentQuizData = data.quizzes;
                    currentQuizIndex = 0;
                    quizScore = 0;
                    renderQuizQuestion();
                } else {
                    alert('ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    // ì—ëŸ¬ ë°œìƒ ì‹œ ë‹¤ì‹œ ì›°ì»´ í™”ë©´ìœ¼ë¡œ
                    showWelcome();
                }
            } catch (e) {
                console.error(e);
                alert('ì„œë²„ í†µì‹  ì˜¤ë¥˜');
                // ì—ëŸ¬ ë°œìƒ ì‹œ ë‹¤ì‹œ ì›°ì»´ í™”ë©´ìœ¼ë¡œ
                showWelcome();
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ (ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´)
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        function renderQuizQuestion() {
            const quiz = currentQuizData[currentQuizIndex];
            const content = document.getElementById('chatContent');

            content.innerHTML = `
                <div class="quiz-container">
                    <div class="quiz-play-card">
                        <div class="quiz-progress">ë¬¸ì œ ${currentQuizIndex + 1} / ${currentQuizData.length}</div>
                        <div class="quiz-question-text">${quiz.question}</div>
                        
                        <div class="quiz-ox-buttons" id="oxButtons">
                            <button class="quiz-ox-btn quiz-btn-o" onclick="checkAnswer('O')">O</button>
                            <button class="quiz-ox-btn quiz-btn-x" onclick="checkAnswer('X')">X</button>
                        </div>

                        <div id="quizFeedback"></div>
                        
                        <button class="quiz-stop-btn" onclick="stopQuiz()" style="
                            margin-top: 30px; 
                            background: transparent; 
                            border: 1px solid var(--border); 
                            color: var(--text-secondary);
                            padding: 8px 16px; 
                            border-radius: 8px; 
                            cursor: pointer;">
                            í€´ì¦ˆ ê·¸ë§Œí•˜ê¸°
                        </button>

                        <button id="btnNextQuiz" class="quiz-next-btn" onclick="nextQuestion()" style="display: none;">ë‹¤ìŒ ë¬¸ì œ</button>
                    </div>
                </div>
            `;
        }

        function checkAnswer(userChoice) {
            const quiz = currentQuizData[currentQuizIndex];
            const feedback = document.getElementById('quizFeedback');
            const buttons = document.getElementById('oxButtons');
            const nextButton = document.getElementById('btnNextQuiz');

            // ë²„íŠ¼ ì¬í´ë¦­ ë°©ì§€
            buttons.style.pointerEvents = 'none';
            buttons.style.opacity = '0.6';

            const isCorrect = userChoice === quiz.answer;
            if (isCorrect) quizScore++;

            const resultClass = isCorrect ? 'correct' : 'wrong';
            const resultText = isCorrect ? 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰' : `í‹€ë ¸ìŠµë‹ˆë‹¤ ğŸ˜… (ì •ë‹µ: ${quiz.answer})`;

            feedback.innerHTML = `
                <div class="quiz-feedback ${resultClass}">
                    <div class="feedback-result">${resultText}</div>
                    <div class="feedback-explanation">${quiz.explanation}</div>
                    <div class="feedback-source">ì¶œì²˜: ${quiz.source}</div>
                    <button class="quiz-next-btn" onclick="nextQuestion()">
                        ${currentQuizIndex < currentQuizData.length - 1 ? 'ë‹¤ìŒ ë¬¸ì œ' : 'ê²°ê³¼ ë³´ê¸°'}
                    </button>
                </div>
            `;
        }

        function nextQuestion() {
            currentQuizIndex++;
            if (currentQuizIndex < currentQuizData.length) {
                renderQuizQuestion();
            } else {
                showQuizResult();
            }
        }

        // í€´ì¦ˆ ì¤‘ë‹¨ í•¨ìˆ˜
        function stopQuiz() {
            if (confirm('í€´ì¦ˆë¥¼ ì¤‘ë‹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”
                currentQuizData = [];
                currentQuizIndex = 0;
                quizScore = 0;
                // ìºì‹œ ì‚­ì œ í›„ ê¸°ë³¸ í™”ë©´ìœ¼ë¡œ
                delete modeContentCache['quiz'];
                showWelcome();
            }
        }

        function showQuizResult() {
            const content = document.getElementById('chatContent');
            content.innerHTML = `
                <div class="quiz-container">
                    <div class="quiz-setup-card">
                        <div class="quiz-setup-title">í€´ì¦ˆ ì¢…ë£Œ! ğŸ</div>
                        <div class="quiz-final-score">${quizScore} / ${currentQuizData.length}</div>
                        <p>ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
                        <button class="quiz-start-btn" onclick="showWelcome()">ë‹¤ì‹œ í•˜ê¸°</button>
                    </div>
                </div>
            `;
        }


        /**
         * ì›°ì»´ í™”ë©´ í‘œì‹œ
         * ëª¨ë“œ ë³€ê²½ ì‹œ ë˜ëŠ” ì´ˆê¸° ë¡œë“œ ì‹œ í˜¸ì¶œë¨
         */
        function showWelcome() {
            const info = SECTIONS.find(s => s.id === currentMode);

            // í€´ì¦ˆ ëª¨ë“œì¼ ê²½ìš° ë³„ë„ UI ë Œë”ë§
            if (currentMode === 'quiz') {
                document.getElementById('chatContent').innerHTML = `
                    <div class="quiz-container">
                        <div class="quiz-setup-card">
                            <div class="quiz-setup-title">ì˜¤ëŠ˜ì˜ í€´ì¦ˆ ë„ì „! ğŸ§©</div>
                            
                            <div class="quiz-option-group">
                                <label class="quiz-option-label">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                                <div class="quiz-radio-group">
                                    <input type="radio" id="catAll" name="quizCategory" value="all" class="quiz-radio-input" checked>
                                    <label for="catAll" class="quiz-radio-label">ëª¨ë‘</label>
                                    
                                    <input type="radio" id="catLec" name="quizCategory" value="lecture" class="quiz-radio-input">
                                    <label for="catLec" class="quiz-radio-label">ê°•ì˜ìë£Œ</label>

                                    <input type="radio" id="catPy" name="quizCategory" value="python" class="quiz-radio-input">
                                    <label for="catPy" class="quiz-radio-label">íŒŒì´ì¬ ê¸°ì´ˆ</label>
                                </div>
                            </div>

                            <div class="quiz-option-group">
                                <label class="quiz-option-label">ë¬¸í•­ ìˆ˜ (5 ~ 20)</label>
                                <input type="number" id="quizCount" class="quiz-input-number" value="5" min="5" max="20">
                            </div>

                            <button id="btnStartQuiz" class="quiz-start-btn" onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
                        </div>
                    </div>
                `;
                return;
            }

            // [ê¸°ì¡´] í•™ìŠµ ëª¨ë“œ ì›°ì»´ í™”ë©´
            document.getElementById('chatContent').innerHTML = `
                <div class="welcome" id="welcome">
                    <!-- ë°°ì§€ ì œê±°ë¨ -->
                    <img src="/image/pymate_logo.png" alt="PyMate" style="width: 220px; height: auto; margin-bottom: 30px; border-radius: 16px;">
                    <h1>ë¬´ì—‡ì„ ë°°ìš°ê³  ì‹¶ìœ¼ì„¸ìš”?</h1>
                    <p>ë¶€íŠ¸ìº í”„ í•™ìŠµ ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ AI íŠœí„°ì…ë‹ˆë‹¤.</p>
                    <div class="suggestions">
                        <div class="suggestion" onclick="send('ê³¼ì í•©ì´ ë­ê³  ì–´ë–»ê²Œ ë°©ì§€í•´?')">
                            <div class="suggestion-icon">ğŸ¯</div>
                            <div class="suggestion-title">ê³¼ì í•©ì´ ë­ê³  ì–´ë–»ê²Œ ë°©ì§€í•´?</div>
                            <div class="suggestion-desc">Overfitting ê°œë…ê³¼ í•´ê²°ë²•</div>
                        </div>
                        <div class="suggestion" onclick="send('ê²°ì •íŠ¸ë¦¬ì™€ ëœë¤í¬ë ˆìŠ¤íŠ¸ ì°¨ì´ê°€ ë­ì•¼?')">
                            <div class="suggestion-icon">ğŸŒ³</div>
                            <div class="suggestion-title">ê²°ì •íŠ¸ë¦¬ì™€ ëœë¤í¬ë ˆìŠ¤íŠ¸ ì°¨ì´ê°€ ë­ì•¼?</div>
                            <div class="suggestion-desc">íŠ¸ë¦¬ ê¸°ë°˜ ì•Œê³ ë¦¬ì¦˜ ë¹„êµ</div>
                        </div>
                        <div class="suggestion" onclick="send('train_test_splitì€ ì™œ í•˜ëŠ” ê±°ì•¼?')">
                            <div class="suggestion-icon">ğŸ“Š</div>
                            <div class="suggestion-title">train_test_splitì€ ì™œ í•˜ëŠ” ê±°ì•¼?</div>
                            <div class="suggestion-desc">ë°ì´í„° ë¶„í• ì˜ í•„ìš”ì„±</div>
                        </div>
                        <div class="suggestion" onclick="send('ì •í™•ë„ì™€ ì •ë°€ë„ ì°¨ì´ ì„¤ëª…í•´ì¤˜')">
                            <div class="suggestion-icon">ğŸ“ˆ</div>
                            <div class="suggestion-title">ì •í™•ë„ì™€ ì •ë°€ë„ ì°¨ì´ ì„¤ëª…í•´ì¤˜</div>
                            <div class="suggestion-desc">í‰ê°€ ì§€í‘œ ë¹„êµ</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ... ê¸°ì¡´ ì½”ë“œ ìœ ì§€
        // checkServerStatus(), setInterval(), renderSections() ë“±ì€ ìœ ì§€ë¨
        // ë‹¨, ê¸°ì¡´ showWelcome()ì€ ë®ì–´ì“°ì—¬ì§

        async function checkServerStatus() {
            const statusText = document.getElementById('dbStatusText');
            if (!statusText) return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000);

                const response = await fetch('/health', { signal: controller.signal });
                clearTimeout(timeoutId);

                if (response.ok) {
                    statusText.textContent = 'Database is successfully connected';
                    statusText.className = 'db-status-text db-status-ok';
                } else {
                    throw new Error('Server Error');
                }
            } catch (e) {
                statusText.textContent = 'Database is not connected';
                statusText.className = 'db-status-text db-status-error';
            }
        }

        // ìµœì´ˆ ì‹¤í–‰ ë° ì£¼ê¸°ì  ë°˜ë³µ (5ì´ˆ)
        checkServerStatus();
        setInterval(checkServerStatus, 5000);

        // ========================================
        // ğŸš€ ì´ˆê¸°í™”
        // ========================================

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ì´ë“œë°” ë Œë”ë§ ë° ì›°ì»´ í™”ë©´ í‘œì‹œ
        renderSections();
        showWelcome();  // ì›°ì»´ í™”ë©´ í‘œì‹œ (ìƒˆ ë²„ì „ HTML ì ìš©)
    </script>

    <!-- DB ìƒíƒœ í…ìŠ¤íŠ¸ (ì˜¤ë¥¸ìª½ ì•„ë˜ ê³ ì •) -->
    <div id="dbStatusText" class="db-status-text">Checking database...</div>
</body>

</html>