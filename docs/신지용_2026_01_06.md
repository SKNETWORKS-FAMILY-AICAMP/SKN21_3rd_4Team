# 작업 일지 - 2026년 1월 6일

## 완료된 작업

### 1. 번역 프롬프트 개선 (`src/agent/prompts/translate_prompt.py`)
- ✅ 키워드 개수 제한: 최소 4개, 최대 10개 (6~8개 최적)
- ✅ 핵심 개념 키워드 보존 규칙 추가
- ✅ 한국어 질문 표현 무시 규칙 추가 ("설명해줘", "사용법" 등)
- ✅ 금지 단어 목록 확장 ("way", "ways" 추가)
- ✅ RST 문서 실제 용어 반영 (메서드 시그니처, 연산자 등)

### 2. 테스트 스크립트 개선 (`src/test_vector_search.py`)
- ✅ 번역 기능 추가 (translate_prompt.py 사용)
- ✅ lecture와 python_doc_rst 분리 검색
- ✅ 임베딩 모델 선택 기능 (파일 상단 EMBEDDING_MODEL 변수)
- ✅ 테스트 질문 추가 (한글 + 영어)

### 3. Ingestion 스크립트 개선 (`src/ingestion_rst.py`)
- ✅ 임베딩 모델 선택 기능 (파일 상단 EMBEDDING_MODEL 변수)
- ✅ 컬렉션 재생성 옵션 (RECREATE_COLLECTION)

---

## 현재 상태

### 번역 프롬프트 테스트 결과
- **평균 유사도**: 약 0.54~0.55
- **개선된 항목**: "파이썬에서 숫자 연산하는 방법" (0.6367), "try except" (0.5919)
- **악화된 항목**: "원시 문자열 리터럴" (0.5064), "상속" (0.5276)

### 문제점
1. 일부 질문에서 키워드가 너무 적게 생성됨 (2~3개)
2. 중요한 키워드가 제거되는 경우 ("method resolution order", "__init__")
3. 관련 키워드 부족으로 검색 정확도 하락

---

## 다음 작업 (집에서 할 일)

### 1. 번역 프롬프트 추가 개선
**파일**: `src/agent/prompts/translate_prompt.py`

**개선 방향**:
- [ ] 키워드 개수 최소값 강제 (최소 4개 보장)
- [ ] 핵심 개념별 필수 키워드 목록 추가
  - 예: "상속" → 반드시 "method resolution order" 포함
  - 예: "원시 문자열" → 반드시 "escape sequences" 포함
- [ ] 예시를 더 구체적으로 추가

**테스트 방법**:
```bash
python src/test_vector_search.py
```

**확인할 질문**:
- "원시 문자열 리터럴이 뭐야?" → 최소 4개 키워드 생성 확인
- "상속이란 무엇인가" → "method resolution order" 포함 확인
- "사용자 정의 예외 만드는 방법" → "__init__" 포함 확인

---

### 2. RST 전처리 개선 (선택사항)
**파일**: `src/ingestion_rst.py`

**개선 방향**:
- [ ] API 시그니처를 프리픽스에 포함
- [ ] 코드 예제에서 키워드 추출
- [ ] 청킹 전략 개선 (의미 단위로 분할)

**테스트 방법**:
```bash
# 컬렉션 재생성 후 재업로드
python src/ingestion_rst.py --recreate-collection
```

---

### 3. 테스트 결과 분석
**파일**: `src/test_vector_search.py`

**분석 항목**:
- [ ] 각 질문별 유사도 점수 기록
- [ ] 번역된 키워드 품질 평가
- [ ] 개선 전후 비교

**목표 유사도**:
- 높은 점수: 0.60+ (목표)
- 중간 점수: 0.50~0.60 (정상)
- 낮은 점수: 0.45~0.50 (개선 필요)

---

## 중요 파일 위치

### 프롬프트 파일
- `src/agent/prompts/translate_prompt.py` - 번역 프롬프트 (수정 완료)
- `src/agent/prompts/search_prompt.py` - 라우터 프롬프트

### 테스트 파일
- `src/test_vector_search.py` - 벡터 검색 테스트 (번역 기능 포함)
- `src/agent/nodes/search_agent.py` - 실제 검색 에이전트

### Ingestion 파일
- `src/ingestion_rst.py` - RST 파일 ingestion (임베딩 모델 선택 가능)
- `src/ingestion_lectures.py` - 강의 노트 ingestion

---

## 설정 변경 방법

### 임베딩 모델 변경
**파일**: `src/test_vector_search.py` (상단)
```python
EMBEDDING_MODEL = "text-embedding-3-large"  # ← 여기 변경!
```

**파일**: `src/ingestion_rst.py` (상단)
```python
EMBEDDING_MODEL = "text-embedding-3-large"  # ← 여기 변경!
```

### 컬렉션 재생성
```bash
# RST 재업로드
python src/ingestion_rst.py --recreate-collection

# 강의 노트 재업로드
python src/ingestion_lectures.py --recreate-collection
```

---

## 주의사항

1. **임베딩 모델과 벡터 크기 일치**
   - `text-embedding-3-small` → 1536 차원
   - `text-embedding-3-large` → 3072 차원
   - lecture와 python_doc_rst가 같은 컬렉션이면 같은 모델 사용 필수

2. **컬렉션 재생성 시**
   - `--recreate-collection` 옵션 사용
   - 기존 데이터 삭제 후 재업로드 필요

3. **테스트 실행**
   - `test_vector_search.py`: 번역 기능 포함, lecture/python_doc_rst 분리 검색
   - `search_agent.py`: 실제 시스템 테스트 (Router + 번역)

---

## 참고 자료

- `docs/유사도_개선_분석.md` - 유사도 개선 방안 상세 분석
- 터미널 출력 비교: 첫 번째 테스트 vs 두 번째 테스트 (개선 전후 비교)

---

## 다음 세션 체크리스트

- [ ] 번역 프롬프트 테스트 결과 확인
- [ ] 유사도 점수 개선 여부 확인
- [ ] 키워드 개수 최적화 확인 (4~8개)
- [ ] 핵심 키워드 보존 확인 ("method resolution order", "__init__" 등)

