# 유사도 개선 로드맵

## 현재 상태
- **평균 유사도**: 0.54~0.56
- **낮은 점수 질문**: 함수 정의 (0.47), 딕셔너리 리터럴 (0.49), 모듈 임포트 (0.48)
- **높은 점수 질문**: 정수 나눗셈 (0.64), 리스트 컴프리헨션 (0.63)

## 개선 방안 (우선순위별)

### 🔴 1순위: 하이브리드 검색 (벡터 + 키워드) - 가장 효과적

**문제점**: 벡터 검색만으로는 키워드 매칭이 약함
- "함수 정의" → "def keyword"가 포함된 chunk를 찾지 못함
- "딕셔너리 리터럴" → "dictionary display" 용어 매칭 부족

**해결책**: 벡터 검색 + 키워드 필터링 결합
```python
# 1. 벡터 검색으로 후보 많이 가져오기 (top_k=20)
# 2. 키워드 매칭 점수 추가
# 3. 최종 점수 = 벡터 유사도 * 0.7 + 키워드 매칭 * 0.3
```

**예상 효과**: +0.05~0.10 유사도 향상

---

### 🟡 2순위: Reranking (재정렬)

**문제점**: 벡터 검색만으로는 정확한 순서가 아닐 수 있음

**해결책**: 더 많은 후보를 가져온 후 재정렬
```python
# 1. 벡터 검색으로 top_k=20 가져오기
# 2. 키워드 빈도, 위치 등으로 재정렬
# 3. 최종 top_k=5 반환
```

**예상 효과**: +0.02~0.05 유사도 향상

---

### 🟢 3순위: Query Expansion (질문 확장)

**문제점**: 번역된 키워드가 부족할 수 있음

**해결책**: 동의어/관련어 추가
```python
# "함수 정의" → "function definition def keyword function statement def statement"
# "딕셔너리" → "dictionary display dict literal dict()"
```

**예상 효과**: +0.01~0.03 유사도 향상

---

### 🔵 4순위: 청킹 전략 개선

**문제점**: chunk_size=900이 너무 클 수 있음

**해결책**: 의미 단위로 청킹
- 함수/클래스 단위로 분할
- 작은 chunk (500~600)로 변경

**예상 효과**: +0.01~0.02 유사도 향상

---

## 추천 실행 순서

### Phase 1: 하이브리드 검색 구현 (가장 효과적)
1. 벡터 검색으로 top_k=20 가져오기
2. 키워드 매칭 점수 계산
3. 가중 평균으로 최종 점수 계산
4. 테스트 및 결과 확인

### Phase 2: Reranking 추가
1. 하이브리드 검색 결과를 더 정교하게 재정렬
2. 키워드 위치 가중치 추가

### Phase 3: Query Expansion
1. 낮은 점수 질문에 대해 동의어 추가
2. 프롬프트 개선으로 키워드 확장

---

## 예상 최종 효과

- **현재**: 0.54~0.56
- **하이브리드 검색 후**: 0.60~0.65
- **Reranking 추가 후**: 0.62~0.67
- **Query Expansion 추가 후**: 0.63~0.68

---

## 구현 난이도

- 하이브리드 검색: ⭐⭐ (중간) - 구현 가능
- Reranking: ⭐ (쉬움) - 구현 가능
- Query Expansion: ⭐ (쉬움) - 프롬프트 개선
- 청킹 개선: ⭐⭐⭐ (어려움) - 전처리 재작업 필요
